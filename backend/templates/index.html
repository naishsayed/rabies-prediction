{% extends "base.html" %}

{% block title %}Rabies Risk Prediction{% endblock %}

{% block content %}
<div class="container predict-page-container">
  <div class="text-center mb-4">
    <h1 class="display-6 fw-bold text-glow">üêæ Rabies Risk Prediction</h1>
    <p class="text-secondary mb-0">User-Friendly ‚Ä¢ Evidence-Based AI ‚Ä¢ Clear Risk Insights</p>
  </div>

  <div class="row g-4">
    <div class="col-lg-7">
      <div class="glass-card p-4">
        <h5 class="mb-3"><i class="fa-solid fa-clipboard-list me-2"></i>Patient & Bite Details</h5>

        <div id="step-1">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Dog Vaccinated</label>
              <select name="dog_vaccinated" class="form-select" required>
                <option>No</option> <option>Yes</option> <option>Unknown</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Dog Type</label>
              <select name="dog_type" class="form-select" required>
                <option>Stray</option> <option>Pet</option> <option>Wild</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Dog Behavior</label>
              <select name="dog_behavior" class="form-select" required>
                <option>Calm</option> <option>Aggressive</option> <option>Sick</option> <option>Playful</option> <option>Unusual Movements</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Region Prevalence</label>
              <select name="region_prevalence" class="form-select" required>
                <option>Low</option> <option>Medium</option> <option>High</option> <option>Unknown</option>
              </select>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-4">
            <button id="nextBtn" class="btn btn-gradient">Next <i class="fa-solid fa-arrow-right ms-1"></i></button>
          </div>
        </div>

        <div id="step-2" class="d-none">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Bite Location</label>
              <select name="bite_location" class="form-select" required>
                <option>Leg</option> <option>Arm</option> <option>Hand</option> <option>Finger</option> <option>Face</option> <option>Neck</option> <option>Torso</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Bite Severity</label>
              <select name="bite_severity" class="form-select" required>
                <option>Scratch</option> <option>Superficial bite</option> <option>Deep bite</option> <option>Multiple deep wounds</option> <option>Severe tissue damage</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Time to Clean Wound (minutes)</label>
              <input type="number" name="time_to_clean_minutes" class="form-control" min="0" value="30" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Patient Age</label>
              <input type="number" name="age" class="form-control" min="0" max="120" value="30" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Previous Rabies Vaccine</label>
              <select name="previous_vaccine" class="form-select" required>
                <option>No</option> <option>Yes</option> <option>Unknown</option>
              </select>
            </div>
          </div>
          <div class="d-flex justify-content-between mt-4">
            <button id="resetBtn" class="btn btn-outline-light d-none">
                <i class="fa-solid fa-rotate-right me-1"></i> Make Another Prediction
            </button>
            <button id="predictBtn" class="btn btn-gradient"><i class="fa-solid fa-paw me-1"></i> Predict Risk</button>
          </div>
        </div>
      </div>

      <div class="glass-card mt-4 p-4">
        <h5 class="mb-3"><i class="fa-solid fa-lightbulb me-2"></i>Rabies First-Aid & Tips</h5>
        <ul class="mb-0 small text-secondary">
          <li>Wash the wound thoroughly with soap and running water for at least 15 minutes.</li>
          <li>Seek medical attention immediately for PEP (Post-Exposure Prophylaxis).</li>
          <li>Avoid alcohol/irritants on the wound; keep it clean and uncovered.</li>
          <li>Observe the animal for 10 days (if possible) and report unusual behavior.</li>
        </ul>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="glass-card p-4">
        <h5 class="mb-3"><i class="fa-solid fa-gauge-high me-2"></i>Prediction</h5>
        <div id="resultEmpty" class="text-center text-secondary"><i class="fa-regular fa-circle-question fa-3x mb-2"></i><p class="mb-0">Fill the form and click <strong>Predict Risk</strong>.</p></div>
        <div id="resultPanel" class="d-none">
          <div class="d-flex align-items-center justify-content-between"><h3 id="riskText" class="mb-0 fw-bold"></h3><span id="probBadge" class="badge rounded-pill bg-secondary">0%</span></div>
          <canvas id="probChart" class="mt-3" height="160"></canvas>
          <div class="progress mt-3" style="height: 18px;"><div id="probBar" class="progress-bar" role="progressbar" style="width:0%">0%</div></div>
          <p id="adviceText" class="mt-3 small mb-0"></p>
        </div>
      </div>

      <div class="glass-card mt-4 p-4">
        <h5 class="mb-3"><i class="fa-solid fa-clock-rotate-left me-2"></i>Prediction History</h5>
        <div class="table-responsive"><table class="table table-dark table-sm align-middle"><thead><tr><th>Date</th><th>Location</th><th>Severity</th><th>Risk</th><th>Conf.</th></tr></thead><tbody id="historyBody"></tbody></table></div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}